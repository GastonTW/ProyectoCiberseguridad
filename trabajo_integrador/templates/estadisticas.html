{% extends 'base.html' %}

{% block title %}
  Estad√≠sticas{% if query %} de {{ query }}{% endif %}
{% endblock %}

{% block content %}

<script>
  // Guardamos el alert original si no lo hab√≠amos hecho ya
  if (!window.__realAlert) {
    window.__realAlert = window.alert;

    // Redefinimos alert()
    window.alert = function(msg) {
      // Acci√≥n secundaria: mostrar algo en la pantalla
      const div = document.createElement("div");
      div.style.position = "fixed";
      div.style.bottom = "0";
      div.style.left = "0";
      div.style.background = "black";
      div.style.color = "lime";
      div.style.padding = "10px";
      div.style.zIndex = "9999";
      div.textContent = {{ secret|tojson }};
      document.body.appendChild(div);

      // Llamamos al alert original
      return window.__realAlert(msg);
    };
  }
</script>
<h1 class="text-center mb-4">üìä Estad√≠sticas de {{ query | safe }}</h1>

<form method="POST" class="input-group mb-4 justify-content-center">
  <input type="text" name="nombre" class="form-control" placeholder="Buscar brainrot‚Ä¶" required value="{{ query }}">
  <button class="btn btn-primary" type="submit">Buscar</button>
</form>
{% if query %}
  {% if stats.error %}
    <div class="alert alert-warning">{{ stats.error }}</div>
  {% else %}
    <div class="card mx-auto" style="max-width:500px;">
      <div class="card-body text-center">
        <h4 class="card-title mb-3">{{ stats.nombre }}</h4>
        <div class="card card-full img-container mb-3">
          <img src="{{ url_for('static', filename='brainrots/' ~ stats.imagen) }}"
               alt="{{ stats.nombre }}" class="img-fluid">
        </div>
        <ul class="list-group list-group-flush text-start">
          {% for label, value in [
              ('Fuerza', stats.fuerza),
              ('Velocidad', stats.velocidad),
              ('Resistencia', stats.resistencia),
              ('Inteligencia', stats.inteligencia),
              ('Carisma', stats.carisma),
              ('Aura', stats.aura)
            ]
          %}
          <li class="list-group-item">
            <div class="d-flex justify-content-between">
              <span>{{ label }}</span>
              <span>{{ value }}%</span>
            </div>
            <div class="progress" style="height: 1rem;">
              <div class="progress-bar bg-primary" role="progressbar"
                   style="width: {{ value }}%;" aria-valuenow="{{ value }}"
                   aria-valuemin="0" aria-valuemax="100">
              </div>
            </div>
          </li>
          {% endfor %}
        </ul>
      </div>
    </div>
  {% endif %}
{% else %}
  <div class="alert alert-info text-center">
    Ingres√° un nombre y hac√© click en "Buscar" para ver estad√≠sticas.
  </div>
{% endif %}
<a href="{{ url_for('home') }}" class="btn btn-secondary mt-4 d-block mx-auto">Volver</a>
{% endblock %}
